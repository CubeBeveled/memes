<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="/assets/styles.css" />

  <title>Meme explorer</title>
</head>

<body>
  <div class="bottom-container">
    <a href="https://github.com/CubeBeveled/memes" target="_blank"><img src="/assets/icons/github.svg"
        class="bottom-icon"></a>
  </div>
</body>

<script type="module">
  import { ignoredDirs, getIcon, getName, getExtension } from './data.js';

  main();
  async function main() {
    await fetch("https://api.github.com/repos/CubeBeveled/memes/contents")
      .then(res => res.json())
      .then(async content => {
        content = content.filter(i => !ignoredDirs.includes(i.name));

        for (const cat of content) {
          const categoryElement = document.createElement("div");
          categoryElement.classList.add("category");

          categoryElement.innerHTML = `<img src="/assets/icons/folder.svg" class="icon"> ${cat.name} `;

          await fetch(`https://api.github.com/repos/CubeBeveled/memes/contents/${cat.name}`)
            .then(res => res.json())
            .then(memes => {
              categoryElement.innerHTML += ` <span class="dim-text">[ ${memes.length} ]</span>`;

              const mediaTypes = new Map();

              memes.forEach(meme => {
                const memeElement = document.createElement("a");
                const icon = getIcon(meme.name);
                const mediaType = icon.replace(".svg", "");

                memeElement.classList.add("meme");
                memeElement.target = "_blank"
                memeElement.href = `/${cat.name}/${meme.name}`;
                memeElement.innerHTML = `<img src="/assets/icons/${icon}" class="icon">${getName(meme.name)}<span class="dim-text">.${getExtension(meme.name)}</span>`;

                if (mediaTypes.has(mediaType)) mediaTypes.get(mediaType).push(memeElement);
                else mediaTypes.set(mediaType, [memeElement]);
              });

              mediaTypes.forEach((memeElements, mediaType) => {
                const detailsElement = document.createElement("details");
                detailsElement.classList.add("media-details");
                detailsElement.innerHTML = `<summary class="media-summary">${mediaType}</summary>`;

                memeElements.forEach((me) => {
                  detailsElement.appendChild(me);
                });

                categoryElement.appendChild(detailsElement);
              });
            });

          document.body.appendChild(categoryElement);
        }
      });
  }
</script>

<script>
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
</script>
<script defer src="/_vercel/insights/script.js"></script>

</html>